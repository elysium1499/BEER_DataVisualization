<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.0">
<title>Section 2 | DataVisualization</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="modulepreload" href="./_observablehq/client.7782eb36.js">
<link rel="modulepreload" href="./_observablehq/runtime.9393ab6d.js">
<link rel="modulepreload" href="./_observablehq/stdlib.3ee9cb94.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/407f7a1f.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.7782eb36.js";
import {registerFile} from "./_observablehq/stdlib.3ee9cb94.js";

registerFile("./data/co2-fossil-plus-land-use.csv", {"name":"./data/co2-fossil-plus-land-use.csv","mimeType":"text/csv","path":"./_file/data/co2-fossil-plus-land-use.14870976.csv","lastModified":1731701676493,"size":316369});

define({id: "beacc02c", inputs: ["FileAttachment"], outputs: ["datasetFossil"], body: async (FileAttachment) => {
//column: Entity,Region,Code,Year,Annual CO₂ emissions,Annual CO₂ emissions from land-use change,Annual CO₂ emissions from fossil fuel
const datasetFossil = await FileAttachment("./data/co2-fossil-plus-land-use.csv").csv({ typed: true });
return {datasetFossil};
}});

define({id: "7c4f44f2", inputs: ["datasetFossil"], outputs: ["d3","sankey","sankeyLinkHorizontal","dataYear2000","ContinentCountryEmissionSankeyChart"], body: async (datasetFossil) => {
// Import necessary D3 libraries
const [d3, { sankey, sankeyLinkHorizontal }] = await Promise.all([
  import("https://cdn.jsdelivr.net/npm/d3@7/+esm"),
  import("https://cdn.jsdelivr.net/npm/d3-sankey@0.12/+esm")
]);


// Filter data for the year 2000 and select top 30 countries by CO₂ emissions
const dataYear2000 = datasetFossil
  .filter(d => d.Year === 2000)  // Filter for the year 2000
  .sort((a, b) => b["Annual CO₂ emissions"] - a["Annual CO₂ emissions"])  // Sort by emissions, descending
  .slice(0, 30);  // Select top 30 countries
console.log("Data for year 2000:", dataYear2000);  // Check filtered data

// Define the chart function to connect continents to countries and countries to emission types
function ContinentCountryEmissionSankeyChart(data, width, height = 600) {
  const continentNodes = [];  // Layer 1: Continent nodes
  const countryNodes = [];    // Layer 2: Country nodes
  const typeNodes = [{ name: "Fossil Use" }, { name: "Land Use" }];  // Layer 3: Emission types
  const links = [];

  // Step 1: Create unique continent nodes
  const uniqueContinents = Array.from(new Set(data.map(d => d.Region)));
  uniqueContinents.forEach(continent => {
    continentNodes.push({ name: continent });
  });

  // Step 2: Create country nodes and links from continent to country
  data.forEach(d => {
    const countryName = d.Entity;
    const continentName = d.Region;

    // Add country node if it doesn't exist
    if (!countryNodes.some(node => node.name === countryName)) {
      countryNodes.push({ name: countryName });
    }

    // Create link from continent to country based on total emissions
    links.push({
      source: continentName,
      target: countryName,
      value: d["Annual CO₂ emissions"]
    });
  });

  // Step 3: Link each country to "Fossil Use" and "Land Use" nodes for specific emission types
  data.forEach(d => {
    const countryName = d.Entity;

    // Link to Fossil emissions if applicable
    if (d["Annual CO₂ emissions from fossil fuel"] > 0) {
      links.push({
        source: countryName,
        target: "Fossil Use",
        value: d["Annual CO₂ emissions from fossil fuel"]
      });
    }

    // Link to Land Use emissions if applicable
    if (d["Annual CO₂ emissions from land-use change"] > 0) {
      links.push({
        source: countryName,
        target: "Land Use",
        value: d["Annual CO₂ emissions from land-use change"]
      });
    }
  });

  // Combine nodes for Sankey setup
  const nodes = [...continentNodes, ...countryNodes, ...typeNodes];

  // Set up the Sankey diagram
  const color = d3.scaleOrdinal(d3.schemeCategory10);

  const { nodes: sankeyNodes, links: sankeyLinks } = sankey()
    .nodeWidth(30)
    .nodePadding(7)
    .extent([[1, 1], [width - 1, height - 6]])({
      nodes: nodes.map(d => ({ ...d })),
      links: links.map(d => ({
        source: nodes.findIndex(n => n.name === d.source),
        target: nodes.findIndex(n => n.name === d.target),
        value: d.value
      }))
    });

  // Create an SVG element
  const svg = d3.create("svg")
    .attr("viewBox", [-30, -30, width , height])
    .attr("width", width -50)
    .attr("height", height)
    .style("min-height", "640px")
    .style("font", "10px sans-serif");

  // Create a tooltip div that is hidden by default
  const tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("position", "absolute")
    .style("background", "rgba(0, 0, 0, 0.7)")
    .style("color", "white")
    .style("padding", "5px 10px")
    .style("border-radius", "4px")
    .style("font-size", "12px")
    .style("pointer-events", "none")
    .style("display", "none");

  svg.append("g")
    .selectAll("rect")
    .data(sankeyNodes)
    .join("rect")
    .attr("x", d => d.x0)
    .attr("y", d => d.y0)
    .attr("height", d => d.y1 - d.y0)
    .attr("width", d => d.x1 - d.x0)
    .attr("fill", d => color(d.name))
    .style("opacity", 0.7)
    .on("mouseover", function(event, d) {
      d3.select(this).style("opacity", 1);
      tooltip.style("display", "block")
        .html(`<strong>${d.name}</strong>`);
    })
    .on("mousemove", event => {
      tooltip.style("top", `${event.pageY + 10}px`)
        .style("left", `${event.pageX + 10}px`);
    })
    .on("mouseout", function() {
      d3.select(this).style("opacity", 0.7);
      tooltip.style("display", "none");
    });

  svg.append("g")
  .attr("fill", "none")
  .selectAll("path")
  .data(sankeyLinks)
  .join("path")
  .attr("d", sankeyLinkHorizontal())
  .attr("stroke", d => color(d.source.name))
  .attr("stroke-width", d => Math.max(1, d.width))
  .attr("opacity", 0.5)
  .on("mouseover", function(event, d) {
    d3.select(this).attr("opacity", 0.8);

    // Verifica il tipo di collegamento basandosi sui nodi di origine e destinazione
    if (continentNodes.some(node => node.name === d.source.name) &&
        countryNodes.some(node => node.name === d.target.name)) {
        tooltip.style("display", "block").html(`<strong>${d.source.name} → ${d.target.name}</strong>`);
    } else if (countryNodes.some(node => node.name === d.source.name) && typeNodes.some(node => node.name === d.target.name)) {
        tooltip.style("display", "block").html(`<strong>${d.source.name} → Value: ${(d.value / 1_000_000_000).toLocaleString()} BT </strong>`);
    }
  })
  .on("mousemove", event => {
    tooltip.style("top", `${event.pageY + 10}px`)
      .style("left", `${event.pageX + 10}px`);
  })
  .on("mouseout", function() {
    d3.select(this).attr("opacity", 0.5);
    tooltip.style("display", "none");
  });

  svg.append("text")
    .attr("x", 0)
    .attr("y", -20)
    .attr("text-anchor", "start")
    .style("font-weight", "bold")
    .style("fill", "white")
    .style("font-size", "16px")
    .text("Region");

  svg.append("text")
    .attr("x", width * 0.5)
    .attr("y", -20)
    .attr("text-anchor", "middle")
    .style("font-weight", "bold")
    .style("fill", "white")
    .style("font-size", "16px")
    .text("Country");

  svg.append("text")
    .attr("x", width)
    .attr("y", -20)
    .attr("text-anchor", "end")
    .style("font-weight", "bold")
    .style("fill", "white")
    .style("font-size", "16px")
    .text("Emission");

  return svg.node();

}

return {d3,sankey,sankeyLinkHorizontal,dataYear2000,ContinentCountryEmissionSankeyChart};
}});

define({id: "40e98c05", mode: "inline", inputs: ["resize","ContinentCountryEmissionSankeyChart","dataYear2000","display"], body: async (resize,ContinentCountryEmissionSankeyChart,dataYear2000,display) => {
display(await(
resize((width) =>ContinentCountryEmissionSankeyChart(dataYear2000, width))
))
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">DataVisualization</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./laboratory1">Section 1</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./laboratory2">Section 2</a></li>
    <li class="observablehq-link"><a href="./laboratory3">Section 3</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#data-and-chart-setup">Data and Chart Setup</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<div class="observablehq observablehq--block"><!--:beacc02c:--></div>
<h1 id="alluvial" tabindex="-1"><a class="observablehq-header-anchor" href="#alluvial">Alluvial</a></h1>
<br>
<h2 id="data-and-chart-setup" tabindex="-1"><a class="observablehq-header-anchor" href="#data-and-chart-setup">Data and Chart Setup</a></h2>
<div class="observablehq observablehq--block"><!--:7c4f44f2:--></div>
<div class="grid grid-cols-1"> 
  <div class="card"> <observablehq-loading></observablehq-loading><!--:40e98c05:--></div> 
</div>
<p>
</p><p>This chart offers a detailed visualization of CO₂ emissions for the year 2022, providing valuable insights into the primary sources of global CO₂ emissions.</p>
<p>Each continent’s total CO₂ emissions are represented by flows, with larger flows indicating greater emissions.</p>
<p>Emission flows split further to individual countries. More significant flows indicate higher national emissions.
Major emitters like the <strong>United States</strong>, <strong>China</strong>, and <strong>Brazil</strong> dominate the chart, reflecting their status as some of the largest contributors to global CO₂ emissions.</p>
<p>The chart divides emissions into two primary categories on the right: <strong>Fossil Fuel Use</strong> and <strong>Land Use</strong>.
Countries such as the <strong>United States</strong> and <strong>China</strong> show significant flows linked to <strong>Fossil Fuel Use</strong>, highlighting their dependence on coal, oil, and natural gas.
In contrast, nations like <strong>Brazil</strong> and other countries in South America exhibit stronger connections to <strong>Land Use</strong> emissions, reflecting the impact of deforestation and land management practices.</p>
<p><strong>Indonesia</strong> and <strong>Russia</strong> also contribute significantly to global emissions, though their flows are smaller compared to top emitters like the U.S. and China.</p>
<p></p>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./laboratory1"><span>Section 1</span></a><a rel="next" href="./laboratory3"><span>Section 3</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-11-22T11:16:37">Nov 22, 2024</a>.</div>
</footer>
</div>
</body>
</html>
